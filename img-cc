#! /bin/bash

# SPDX-License-Identifier: MPL-2.0

webpavif="WEBP to AVIF"
pngavif="PNG to AVIF"
jpgjxl="JPG to JXL"
pngjxl="PNG to JXL"
jpgjxllo="JPG to JXL (Lossy)"

# altconvs="Alternate Conversions"
quit="Quit"

choices=$(gum choose --header="What are we converting today?" "$pngavif" "$webpavif" "$jpgjxl" "$pngjxl" "$jpgjxllo" "$quit")

# if [[ "$choices" == "$jpgjxl" ]]; then
choice="$choices"

case $choice in
  "$webpavif") fpaths="./*.[Ww][Ee][Bb][Pp]" ;;
  "$pngavif") fpaths="./*.[Pp][Nn][Gg]" ;;
  "$jpgjxl") fpaths="./*.[Jj][Pp]*[Gg]" ;;
  "$pngjxl") fpaths="./*.[Pp][Nn][Gg]" ;;
  "$jpgjxllo") fpaths="./*.[Jj][Pp]*[Gg]" ;;
  "$quit") exit 1 ;;
esac


revdir() {
  mkdir _review || {
    echo "Folder _review already exists, please rename or remove before continuing!" >&2
    exit 1
  }
}

conversion() {
  for f in $fpaths ; do
    if [[ -f "$f" && ! -L "$f" ]]; then
      cjxl --quiet --lossless_jpeg=1 "$f" "${f%.*}.jxl"
    fi
    # gum spin --title "Converting..."
  done
}

moveto() {
  for e in $fpaths ; do
    if [[ -f "$e" && ! -L "$e" ]]; then
      mv "$e" _review
    fi
  done
}

revdir

conversion 
# gum spin --title "Converting..."

moveto
